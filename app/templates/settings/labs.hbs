<section class="gh-canvas">
    <GhCanvasHeader class="gh-canvas-header">
        <h2 class="gh-canvas-title" data-test-screen-title>
            实验室
        </h2>
    </GhCanvasHeader>

    <section class="view-container settings-debug">
        <p class="gh-box gh-box-info">{{svg-jar "idea"}}测试与试验性功能的测试场，未来可能会改变、中断甚至被移除。</p>

        {{#if session.user.isOwner}}
        <div class="gh-setting-header">会员 (BETA) </div>
        <div class="flex flex-column br3 shadow-1 bg-grouped-table mt2">
            <div class="gh-setting-first gh-setting-last">
                <div class="gh-members-setting-content">
                    <div class="flex">
                        <div class="flex flex-column flex-grow-1">
                            <div class="gh-setting-title pl5 pt5">使用会员</div>
                            <div class="gh-setting-desc pl5 pb5">创建注册会员与付费订阅 — <a href="https://ghost.org/docs/members/" target="_blank" rel="noopener">如何使用</a></div>
                        </div>
                        <div class="gh-setting-action">
                            <div class="for-switch pa5">{{gh-feature-flag "members"}}</div>
                        </div>
                    </div>
                    {{#liquid-if feature.labs.members}}
                    {{gh-members-lab-setting
                        settings=settings
                        setDefaultContentVisibility=(action "setDefaultContentVisibility")
                        setMembersSubscriptionSettings=(action "setMembersSubscriptionSettings")
                    }}
                    <div class="mt5 pl5 pr5 pb5">
                        {{gh-task-button "保存会员设置"
                            task=saveSettings
                            successText="已保存"
                            runningText="正在保存"
                            class="gh-btn gh-btn-blue gh-btn-icon"
                        }}
                    </div>
                    {{/liquid-if}}
                </div>
            </div>
        </div>
        {{/if}}
        <div class="gh-setting-header">迁移选项</div>
        <div class="flex flex-column br3 shadow-1 bg-grouped-table pa5 mt2">
            <div class="gh-setting-first">
                <div class="gh-setting-content">
                    <div class="gh-setting-title">导入内容</div>
                    <div class="gh-setting-desc">从其他安装实例中导入内容</div>
                </div>
                <div class="gh-setting-action">
                    <form id="settings-import" enctype="multipart/form-data">
                        {{gh-file-upload
                            id="importfile"
                            classNames="flex"
                            uploadButtonText=uploadButtonText
                            onUpload=(action "onUpload")
                            acceptEncoding=importMimeType
                            data-test-file-input="import"}}
                    </form>
                </div>
            </div>

            {{#if importErrors}}
                <div class="gh-import-errors {{if importSuccessful "gh-import-errors-warning"}}" data-test-import-errors>
                    <div class="gh-import-errors-title">
                        {{#if importSuccessful}}
                            导入成功，有警告
                        {{else}}
                            导入失败
                        {{/if}}
                    </div>

                    {{#each importErrors as |error|}}
                        <div class="gh-import-error" data-test-import-error>
                            <p class="gh-import-error-message" data-test-import-error-message>
                                {{#if error.help}}{{error.help}}: {{/if}}{{error.message}}
                            </p>

                            {{#if error.context}}
                                <div class="gh-import-error-entry" data-test-import-error-context>
                                    <pre>{{error.context}}</pre>
                                </div>
                            {{/if}}
                        </div>
                    {{/each}}
                </div>
            {{/if}}

            <div class="gh-setting">
                <div class="gh-setting-content">
                    <div class="gh-setting-title">导出内容</div>
                    <div class="gh-setting-desc">导出所有文章与设置导单一大JSON文件</div>
                </div>
                <div class="gh-setting-action">
                    <button type="button" class="gh-btn gh-btn-hover-blue" {{action "downloadFile" "db"}}><span>导出</span></button>
                </div>
            </div>
            <div class="gh-setting-last">
                <div class="gh-setting-content">
                    <div class="gh-setting-title">删除所有内容</div>
                    <div class="gh-setting-desc">从数据库中删除所有文章和标签，硬重置</div>
                </div>
                <div class="gh-setting-action">
                    <button type="button" class="gh-btn gh-btn-hover-red js-delete" {{action "toggleDeleteAllModal"}}><span>删除</span></button>
                </div>
            </div>
        </div>

        <div class="gh-setting-header">Beta功能</div>
        <div class="flex flex-column br3 shadow-1 bg-grouped-table pa5 mt2">
            <div class="gh-setting-first">
                <div class="gh-setting-content">
                    <div class="gh-setting-title">深色模式</div>
                    <div class="gh-setting-desc">切换配色方案到深色背景模式</div>
                </div>
                <div class="gh-setting-action">
                    <div class="for-switch">{{gh-feature-flag "nightShift"}}</div>
                </div>
            </div>
            <div class="gh-setting">
                {{#gh-uploader
                    extensions=jsonExtension
                    uploadUrl="/redirects/json/"
                    paramName="redirects"
                    onUploadSuccess=(perform redirectUploadResult true)
                    onUploadFailure=(perform redirectUploadResult false)
                    as |uploader|
                }}
                <div class="gh-setting-content">
                    <div class="gh-setting-title">重定向</div>
                    <div class="gh-setting-desc">重定向旧的或被删除的内容，更多信息请查看<a href="https://ghost.org/tutorials/implementing-redirects/">文档</a></div>
                    {{#each uploader.errors as |error|}}
                        <div class="gh-setting-error" data-test-error="redirects">{{or error.context error.message}}</div>
                    {{/each}}
                </div>
                <div class="gh-setting-action" style="display: flex; flex-direction: column">
                    {{#if uploader.isUploading}}
                        {{uploader.progressBar}}
                    {{else}}
                        <button
                            type="button"
                            class="gh-btn gh-btn-icon {{if redirectSuccess "gh-btn-green"}} {{if redirectFailure "gh-btn-red"}}"
                            onclick={{action "triggerFileDialog"}}
                            data-test-button="upload-redirects"
                        >
                            <span>
                                {{#if redirectSuccess}}
                                    {{svg-jar "check-circle"}} 上传
                                {{else if redirectFailure}}
                                    {{svg-jar "retry"}} 上传失败
                                {{else}}
                                    上传重定向JSON项
                                {{/if}}
                            </span>
                        </button>
                        <span><a href="#" {{action "downloadFile" "redirects/json"}} data-test-link="download-redirects">下载当前重定向项</a></span>
                    {{/if}}

                    <div style="display:none">
                        {{gh-file-input multiple=false action=uploader.setFiles accept=jsonMimeType data-test-file-input="redirects"}}
                    </div>
                </div>
                {{/gh-uploader}}
            </div>
            <div class="gh-setting-last">
                {{#gh-uploader
                    extensions=yamlExtension
                    uploadUrl="/settings/routes/yaml/"
                    paramName="routes"
                    onUploadSuccess=(perform routesUploadResult true)
                    onUploadFailure=(perform routesUploadResult false)
                    as |uploader|
                }}
                <div class="gh-setting-content">
                    <div class="gh-setting-title">路由</div>
                    <div class="gh-setting-desc">修改routes.yaml文件配置动态路由</div>
                    {{#each uploader.errors as |error|}}
                        <div class="gh-setting-error" data-test-error="routes">{{or error.context error.message}}</div>
                    {{/each}}
                </div>
                <div class="gh-setting-action" style="display: flex; flex-direction: column">
                    {{#if uploader.isUploading}}
                        {{uploader.progressBar}}
                    {{else}}
                        <button
                            type="button"
                            class="gh-btn gh-btn-icon {{if routesSuccess "gh-btn-green"}} {{if routesFailure "gh-btn-red"}}"
                            onclick={{action "triggerFileDialog"}}
                            data-test-button="upload-routes"
                        >
                            <span>
                                {{#if routesSuccess}}
                                    {{svg-jar "check-circle"}} 上传
                                {{else if routesFailure}}
                                    {{svg-jar "retry"}} 上传失败
                                {{else}}
                                    上传路由YAML文件
                                {{/if}}
                            </span>
                        </button>
                        <span><a href="#" {{action "downloadFile" "settings/routes/yaml"}} data-test-link="download-routes">下载当前routes.yaml文件</a></span>
                    {{/if}}

                    <div style="display:none">
                        {{gh-file-input multiple=false action=uploader.setFiles accept=yamlMimeType data-test-file-input="routes"}}
                    </div>
                </div>
                {{/gh-uploader}}
            </div>
        </div>

        <div class="gh-setting-header">测试工具</div>
        <div class="flex flex-column br3 shadow-1 bg-grouped-table pa5 mt2">
            <div class="gh-setting-first gh-setting-last">
                <div class="gh-setting-content">
                    <div class="gh-setting-title">测试Email配置</div>
                    <div class="gh-setting-desc">给自己发送一封Email测试是否配置正确</div>
                </div>
                <div class="gh-setting-action">
                    {{gh-task-button "发送" successText="已发送" task=sendTestEmail class="gh-btn gh-btn-hover-blue gh-btn-icon"}}
                </div>
            </div>
        </div>

    </section>
</section>

{{#if showDeleteAllModal}}
    {{gh-fullscreen-modal "delete-all"
                          close=(action "toggleDeleteAllModal")
                          modifier="action wide"}}
{{/if}}
